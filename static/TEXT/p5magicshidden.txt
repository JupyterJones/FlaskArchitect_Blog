from IPython.core.magic import register_cell_magic
from IPython.display import IFrame

TEMPLATE = """
<html>
<head>
<script type="text/javascript" src="p5.js"></script>
<script type="text/javascript" src="p5.dom.js"></script>
<script type="text/javascript" src="p5.sound.js"></script>
</head>
<body>
<h3>Script: %(name)s</h3>
<script>
%(script)s
</script>
</body>
</html>
"""

COUNT = 0

@register_cell_magic
def p5(line, cell):
    global COUNT
    filename = "p5-%s.html" % COUNT
    COUNT += 1
    with open(filename, "w") as fp:
        fp.write(TEMPLATE % {"script": cell, "name": filename})
    return IFrame(filename, width="100%", height="400")

del p5
