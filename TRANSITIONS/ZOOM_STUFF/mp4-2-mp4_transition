#!/home/jack/miniconda3/envs/cloned_base/bin/python
import os
import moviepy.editor as mpy
import uuid
from sys import argv

def create_transition(video_path1, video_path2, output_path, transition_duration=.5, fps=30):
    """Create a crossfade transition between two videos."""
    video1 = mpy.VideoFileClip(video_path1)
    video2 = mpy.VideoFileClip(video_path2)

    # Calculate the duration of the overlap
    duration1 = video1.duration
    duration2 = video2.duration
    total_duration = duration1 + duration2 - transition_duration

    # Create the crossfade effect
    video1 = video1.set_end(duration1).crossfadeout(transition_duration)
    video2 = video2.set_start(duration1 - transition_duration).crossfadein(transition_duration)

    # Concatenate the videos
    final_video = mpy.concatenate_videoclips([video1, video2], method="compose")
    final_video = final_video.set_duration(total_duration)
    
    # Write the output video file
    final_video.write_videofile(output_path, fps=fps)
    print(f"Saved video: {output_path}")

def main(video_path1, video_path2):
    # Set the output video path using uuid
    ui = str(uuid.uuid4())
    output_video_path = ui + '_transition.mp4'

    # Create the transition video
    create_transition(video_path1, video_path2, output_video_path)

if __name__ == '__main__':
    if len(argv) != 3:
        print("Usage: script.py <video1> <video2>")
    else:
        video_path1 = argv[1]
        video_path2 = argv[2]
        main(video_path1, video_path2)
